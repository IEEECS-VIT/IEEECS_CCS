<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <link
      href="https://fonts.googleapis.com/css?family=Poppins:400,600,700"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.css"
    />
    <script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css"
    />
    <!-- <link rel="stylesheet" href="../node_modules/sal.js/dist/sal.css"> -->
    <link rel="stylesheet" href="/stylesheets/quiz.css" />
    <title>IEEECS Selection | Quiz</title>
  </head>

  <body>
    <div id="cover"></div>
    <script>
      $(window).on("load", function() {
        $("#cover").fadeOut(200);
      });
    </script>
    <div class="navbar-fixed">
      <nav class="nav-extended">
        <div class="nav-wrapper">
          <a href="#" class="brand-logo left"
            ><img src="/images/IEEE-CS_New.png" alt="logo" class="custom-logo"
          /></a>

          <div class="right" style="margin-right:10px">
            <span class="watch" id="timer"></span>
          </div>

          <a href="#" data-target="mobile" class="sidenav-trigger"
            ><i class="fa fa-bars" style="color:white; font-size: 24px"></i
          ></a>
          <ul id="nav-mobile" class="right hide-on-med-and-down">
            <li><a onclick="submit()" class="snl">Submit</a></li>
            <!-- <li><a href="/logout" class="snl">Logout</a></li> -->
          </ul>
        </div>
        <div class="nav-content">
          <ul class="tabs tabs-transparent">
            <li class="tab">
              <a class="active" href="#technical_tab">Technical</a>
            </li>
            <li class="tab"><a href="#management_tab">Management</a></li>
            <li class="tab"><a href="#design_tab">Design</a></li>
          </ul>
        </div>
      </nav>
    </div>
    <ul class="sidenav custom-sidenav" id="mobile">
      <li class="center">
        <img
          src="/images/IEEE-CS_New.png"
          alt="logo"
          class="custom-logo mobile-logo"
        />
      </li>
      <li><a onclick="submit()" style="color:white">Submit</a></li>
      <!-- <li><a href="/logout" style="color:white">Logout</a></li> -->
    </ul>
    <% var count=0%>
    <div id="technical_tab" class="col s12">
      <div class="box tech-q">
        <% var t_count=0; %> <% data.response.forEach((obj) => { %> <%
        if(obj.questionId.qDomain == "technical") { %>
        <div class="question">
          <% t_count++; count++; %>
          <div class="repeated">
            <h5>Question <%=t_count%></h5>
            <p class="q"><%= obj.questionId.question %></p>
            <p id="qid<%=count%>" style="display:none">
              <%=obj.questionId._id%>
            </p>
            <textarea
              id="q<%=count%>"
              class="materialize-textarea"
              placeholder="Type your answer"
              data-length="1000"
            ></textarea>
          </div>
        </div>
        <% }}); %> <% if (t_count==0) { %>
        <h5 style="text-align:center;">You have not chosen this domain...</h5>
        <% } %>
      </div>
    </div>
    <div id="management_tab" class="col s12">
      <div class="box tech-q">
        <% var m_count=0; %> <% data.response.forEach((obj) => { %> <%
        if(obj.questionId.qDomain == "management") { %>
        <div class="question">
          <% m_count++;count++; %>
          <div class="repeated">
            <h5>Question <%=m_count%></h5>
            <p class="q"><%= obj.questionId.question %></p>
            <p id="qid<%=count%>" style="display:none">
              <%=obj.questionId._id%>
            </p>
            <textarea
              id="q<%=count%>"
              class="materialize-textarea"
              placeholder="Type your answer"
              data-length="1000"
            ></textarea>
          </div>
        </div>
        <% }}); %> <% if (m_count==0) { %>
        <h5 style="text-align:center;">You have not chosen this domain...</h5>
        <% } %>
      </div>
    </div>
    <div id="design_tab" class="col s12">
      <div class="box tech-q">
        <% var d_count=0; %> <% data.response.forEach((obj) => { %> <%
        if(obj.questionId.qDomain == "design") { %>
        <div class="question">
          <% d_count++; count++;%>
          <div class="repeated">
            <h5>Question <%=d_count%></h5>
            <p class="q"><%= obj.questionId.question %></p>
            <p id="qid<%=count%>" style="display:none">
              <%=obj.questionId._id%>
            </p>
            <textarea
              id="q<%=count%>"
              class="materialize-textarea"
              placeholder="Type your answer"
              data-length="1000"
            ></textarea>
          </div>
        </div>
        <% }}); %> <% if (d_count==0) { %>
        <h5 style="text-align:center;">You have not chosen this domain...</h5>
        <% } %>
      </div>
    </div>
    <div id="modal1" class="modal">
      <div class="modal-content" style="color:black;">
        <h4>Time Up!</h4>
        <p>
          Unfortunately your time to finish the test is up, your answers will be
          saved automatically! <br />
          You will be contacted shortly if you qualify and proceed for further
          rounds.
        </p>
      </div>
      <!--
        <div class="modal-footer">
          <a href="/thanks" class="modal-close waves-effect waves-green btn-flat">Finish</a>
        </div>
      -->
    </div>
    <!-- add here -->

    <script>
      $(document).ready(function() {
        $(".tabs").tabs({
          // duration: 200,
          // swipeable: true,
          // responsiveThreshold: 768.1,
        });
        $(".sidenav").sidenav();
        $(".modal").modal({
          opacity: 0.8,
          dismissible: false,
          startingTop: "20%"
          // onCloseEnd
        });
        $(".materialize-textarea").val("");
        M.textareaAutoResize($(".materialize-textarea"));
        $(".materialize-textarea").characterCounter();
      });
    </script>
    <script>
      var sec = parseInt("<%=data.maxTime%>");
      // var sec = 10;
      var time = setInterval(myTimer, 1000);
      var flag = 0;

      function submit() {
        flag = 1;
        clearInterval(time);
        var totQues = parseInt("<%=count%>");
        console.log(totQues);
        var solutions = [];
        for (var i = 1; i <= totQues; i++) {
          var obj = {
            userSolution: $("#q" + i).val(),
            questionId: $("#qid" + i)
              .text()
              .trim()
          };
          solutions.push(obj);
          console.log(solutions);
        }
        $.ajax({
          url: "/question",
          method: "POST",
          dataType: "json",
          contentType: "application/x-www-form-urlencoded",
          data: {
            solutions: solutions
          },
          success: function(res) {
            if (res.success == true) {
              window.location.href = "/thanks";
            }
          },
          error: function(msg) {
            console.log(msg);
          }
        });
      }
      // var time = setInterval(myTimer, 1000);
      var timeUpMsg = "Time Up!";

      function myTimer() {
        document.getElementById("timer").innerHTML =
          parseInt(sec / 60) + "min " + (sec % 60) + "sec left";
        sec--;
        if (sec < 0) {
          // alert("Time out!! :(");
          clearInterval(time);
          document.getElementById("timer").innerHTML = timeUpMsg;
          $(".modal").modal("open");
          submit();
          $(".modal").closeModal();
        }
      }

      window.onbeforeunload = confirmExit;

      function confirmExit(event) {
        if (flag == 0) event.returnValue = "Sure?";
        return null;
      }
    </script>
    <script>
      let questionElements = document.getElementsByClassName("q");
      for (let i = 0; i < questionElements.length; i++) {
        questionElements[i].innerHTML = questionElements[i].innerHTML.replace(
          /(\\n|\n)/g,
          "<br />"
        );
      }
    </script>
  </body>
</html>
